shadow$provide.module$node_modules$$ethersproject$providers$lib$base_provider=function(global,require,module,exports){function checkTopic(topic){if(null==topic)return"null";32!==(0,bytes_1.hexDataLength)(topic)&&logger.throwArgumentError("invalid topic","topic",topic);return topic.toLowerCase()}function serializeTopics(topics){for(topics=topics.slice();0<topics.length&&null==topics[topics.length-1];)topics.pop();return topics.map(function(topic$jscomp$0){if(Array.isArray(topic$jscomp$0)){var unique_1=
{};topic$jscomp$0.forEach(function(topic){unique_1[checkTopic(topic)]=!0});topic$jscomp$0=Object.keys(unique_1);topic$jscomp$0.sort();return topic$jscomp$0.join("|")}return checkTopic(topic$jscomp$0)}).join("\x26")}function deserializeTopics(data){return""===data?[]:data.split(/&/g).map(function(topic$jscomp$0){if(""===topic$jscomp$0)return[];topic$jscomp$0=topic$jscomp$0.split("|").map(function(topic){return"null"===topic?null:topic});return 1===topic$jscomp$0.length?topic$jscomp$0[0]:topic$jscomp$0})}
function getEventTag(eventName){if("string"===typeof eventName){eventName=eventName.toLowerCase();if(32===(0,bytes_1.hexDataLength)(eventName))return"tx:"+eventName;if(-1===eventName.indexOf(":"))return eventName}else{if(Array.isArray(eventName))return"filter:*:"+serializeTopics(eventName);if(abstract_provider_1.ForkEvent.isForkEvent(eventName))throw logger.warn("not implemented"),Error("not implemented");if(eventName&&"object"===typeof eventName)return"filter:"+(eventName.address||"*")+":"+serializeTopics(eventName.topics||
[])}throw Error("invalid event - "+eventName);}function getTime(){return(new Date).getTime()}function stall(duration){return new Promise(function(resolve){setTimeout(resolve,duration)})}function bytes32ify(value){return(0,bytes_1.hexZeroPad)(bignumber_1.BigNumber.from(value).toHexString(),32)}function base58Encode(data){return basex_1.Base58.encode((0,bytes_1.concat)([data,(0,bytes_1.hexDataSlice)((0,sha2_1.sha256)((0,sha2_1.sha256)(data)),0,4)]))}function _parseString(result,start){try{return(0,strings_1.toUtf8String)(_parseBytes(result,
start))}catch(error){}return null}function _parseBytes(result,start){if("0x"===result)return null;start=bignumber_1.BigNumber.from((0,bytes_1.hexDataSlice)(result,start,start+32)).toNumber();var length=bignumber_1.BigNumber.from((0,bytes_1.hexDataSlice)(result,start,start+32)).toNumber();return(0,bytes_1.hexDataSlice)(result,start+32,start+32+length)}function getIpfsLink(link){link.match(/^ipfs:\/\/ipfs\//i)?link=link.substring(12):link.match(/^ipfs:\/\//i)?link=link.substring(7):logger.throwArgumentError("unsupported IPFS format",
"link",link);return"https://gateway.ipfs.io/ipfs/"+link}function numPad(value){value=(0,bytes_1.arrayify)(value);if(32<value.length)throw Error("internal; should not happen");var padded=new Uint8Array(32);padded.set(value,32-value.length);return padded}function encodeBytes(datas){for(var result=[],byteCount=0,i=0;i<datas.length;i++)result.push(null),byteCount+=32;for(i=0;i<datas.length;i++){var data=(0,bytes_1.arrayify)(datas[i]);result[i]=numPad(byteCount);result.push(numPad(data.length));var JSCompiler_temp_const=
result,JSCompiler_temp_const$jscomp$0=JSCompiler_temp_const.push;var JSCompiler_inline_result=data;if(0!==JSCompiler_inline_result.length%32){var result$jscomp$0=new Uint8Array(32*Math.ceil(JSCompiler_inline_result.length/32));result$jscomp$0.set(JSCompiler_inline_result);JSCompiler_inline_result=result$jscomp$0}JSCompiler_temp_const$jscomp$0.call(JSCompiler_temp_const,JSCompiler_inline_result);byteCount+=32+32*Math.ceil(data.length/32)}return(0,bytes_1.hexConcat)(result)}var __extends=this&&this.__extends||
function(){var extendStatics=function(d$jscomp$0,b$jscomp$0){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(d[p]=b[p])};return extendStatics(d$jscomp$0,b$jscomp$0)};return function(d,b){function __(){this.constructor=d}if("function"!==typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");extendStatics(d,b);d.prototype=null===
b?Object.create(b):(__.prototype=b.prototype,new __)}}(),__awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new (P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,
rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})},__generator=this&&this.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:return _.label++,
{value:op[1],done:!1};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=0<t.length&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3]))_.label=op[1];else if(6===op[0]&&_.label<t[1])_.label=t[1],t=op;else if(t&&_.label<t[2])_.label=t[2],_.ops.push(op);else{t[2]&&_.ops.pop();_.trys.pop();continue}}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?
op[1]:void 0,done:!0}}var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),"throw":verb(1),"return":verb(2)},"function"===typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};global=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{"default":mod}};Object.defineProperty(exports,"__esModule",{value:!0});exports.BaseProvider=exports.Resolver=exports.Event=void 0;var abstract_provider_1=require("module$node_modules$$ethersproject$abstract_provider$lib$index"),
base64_1=require("module$node_modules$$ethersproject$base64$lib$index"),basex_1=require("module$node_modules$$ethersproject$basex$lib$index"),bignumber_1=require("module$node_modules$$ethersproject$bignumber$lib$index"),bytes_1=require("module$node_modules$$ethersproject$bytes$lib$index"),constants_1=require("module$node_modules$$ethersproject$constants$lib$index"),hash_1=require("module$node_modules$$ethersproject$hash$lib$index"),networks_1=require("module$node_modules$$ethersproject$networks$lib$index"),
properties_1=require("module$node_modules$$ethersproject$properties$lib$index"),sha2_1=require("module$node_modules$$ethersproject$sha2$lib$index"),strings_1=require("module$node_modules$$ethersproject$strings$lib$index"),web_1=require("module$node_modules$$ethersproject$web$lib$index"),bech32_1=global(require("module$node_modules$bech32$index")),logger_1=require("module$node_modules$$ethersproject$logger$lib$index");global=require("module$node_modules$$ethersproject$providers$lib$_version");var logger=
new logger_1.Logger(global.version),formatter_1=require("module$node_modules$$ethersproject$providers$lib$formatter"),PollableEvents=["block","network","pending","poll"],Event$jscomp$0=function(){function Event(tag,listener,once){(0,properties_1.defineReadOnly)(this,"tag",tag);(0,properties_1.defineReadOnly)(this,"listener",listener);(0,properties_1.defineReadOnly)(this,"once",once);this._lastBlockNumber=-2;this._inflight=!1}Object.defineProperty(Event.prototype,"event",{get:function(){switch(this.type){case "tx":return this.hash;
case "filter":return this.filter}return this.tag},enumerable:!1,configurable:!0});Object.defineProperty(Event.prototype,"type",{get:function(){return this.tag.split(":")[0]},enumerable:!1,configurable:!0});Object.defineProperty(Event.prototype,"hash",{get:function(){var comps=this.tag.split(":");return"tx"!==comps[0]?null:comps[1]},enumerable:!1,configurable:!0});Object.defineProperty(Event.prototype,"filter",{get:function(){var comps=this.tag.split(":");if("filter"!==comps[0])return null;var address=
comps[1];comps=deserializeTopics(comps[2]);var filter={};0<comps.length&&(filter.topics=comps);address&&"*"!==address&&(filter.address=address);return filter},enumerable:!1,configurable:!0});Event.prototype.pollable=function(){return 0<=this.tag.indexOf(":")||0<=PollableEvents.indexOf(this.tag)};return Event}();exports.Event=Event$jscomp$0;var coinInfos={0:{symbol:"btc",p2pkh:0,p2sh:5,prefix:"bc"},2:{symbol:"ltc",p2pkh:48,p2sh:50,prefix:"ltc"},3:{symbol:"doge",p2pkh:30,p2sh:22},60:{symbol:"eth",ilk:"eth"},
61:{symbol:"etc",ilk:"eth"},700:{symbol:"xdai",ilk:"eth"}},matcherIpfs=RegExp("^(ipfs)://(.*)$","i"),matchers=[RegExp("^(https)://(.*)$","i"),RegExp("^(data):(.*)$","i"),matcherIpfs,RegExp("^eip155:[0-9]+/(erc[0-9]+):(.*)$","i")],Resolver=function(){function Resolver(provider,address,name,resolvedAddress){(0,properties_1.defineReadOnly)(this,"provider",provider);(0,properties_1.defineReadOnly)(this,"name",name);(0,properties_1.defineReadOnly)(this,"address",provider.formatter.address(address));(0,properties_1.defineReadOnly)(this,
"_resolvedAddress",resolvedAddress)}Resolver.prototype.supportsWildcard=function(){var _this=this;this._supportsEip2544||(this._supportsEip2544=this.provider.call({to:this.address,data:"0x01ffc9a79061b92300000000000000000000000000000000000000000000000000000000"}).then(function(result){return bignumber_1.BigNumber.from(result).eq(1)}).catch(function(error){if(error.code===logger_1.Logger.errors.CALL_EXCEPTION)return!1;_this._supportsEip2544=null;throw error;}));return this._supportsEip2544};Resolver.prototype._fetch=
function(selector,parameters){return __awaiter(this,void 0,void 0,function(){var tx,parseBytes,result,error_1;return __generator(this,function(_a){switch(_a.label){case 0:return tx={to:this.address,ccipReadEnabled:!0,data:(0,bytes_1.hexConcat)([selector,(0,hash_1.namehash)(this.name),parameters||"0x"])},parseBytes=!1,[4,this.supportsWildcard()];case 1:_a.sent()&&(parseBytes=!0,tx.data=(0,bytes_1.hexConcat)(["0x9061b923",encodeBytes([(0,hash_1.dnsEncode)(this.name),tx.data])])),_a.label=2;case 2:return _a.trys.push([2,
4,,5]),[4,this.provider.call(tx)];case 3:return result=_a.sent(),4===(0,bytes_1.arrayify)(result).length%32&&logger.throwError("resolver threw error",logger_1.Logger.errors.CALL_EXCEPTION,{transaction:tx,data:result}),parseBytes&&(result=_parseBytes(result,0)),[2,result];case 4:error_1=_a.sent();if(error_1.code===logger_1.Logger.errors.CALL_EXCEPTION)return[2,null];throw error_1;case 5:return[2]}})})};Resolver.prototype._fetchBytes=function(selector,parameters){return __awaiter(this,void 0,void 0,
function(){var result;return __generator(this,function(_a){switch(_a.label){case 0:return[4,this._fetch(selector,parameters)];case 1:return result=_a.sent(),null!=result?[2,_parseBytes(result,0)]:[2,null]}})})};Resolver.prototype._getAddress=function(coinType,hexBytes){var coinInfo=coinInfos[String(coinType)];null==coinInfo&&logger.throwError("unsupported coin type: "+coinType,logger_1.Logger.errors.UNSUPPORTED_OPERATION,{operation:"getAddress("+coinType+")"});if("eth"===coinInfo.ilk)return this.provider.formatter.address(hexBytes);
coinType=(0,bytes_1.arrayify)(hexBytes);if(null!=coinInfo.p2pkh){var p2pkh=hexBytes.match(/^0x76a9([0-9a-f][0-9a-f])([0-9a-f]*)88ac$/);if(p2pkh){var length_1=parseInt(p2pkh[1],16);if(p2pkh[2].length===2*length_1&&1<=length_1&&75>=length_1)return base58Encode((0,bytes_1.concat)([[coinInfo.p2pkh],"0x"+p2pkh[2]]))}}return null!=coinInfo.p2sh&&(hexBytes=hexBytes.match(/^0xa9([0-9a-f][0-9a-f])([0-9a-f]*)87$/))&&(p2pkh=parseInt(hexBytes[1],16),hexBytes[2].length===2*p2pkh&&1<=p2pkh&&75>=p2pkh)?base58Encode((0,bytes_1.concat)([[coinInfo.p2sh],
"0x"+hexBytes[2]])):null!=coinInfo.prefix&&(p2pkh=coinType[1],hexBytes=coinType[0],0===hexBytes?20!==p2pkh&&32!==p2pkh&&(hexBytes=-1):hexBytes=-1,0<=hexBytes&&coinType.length===2+p2pkh&&1<=p2pkh&&75>=p2pkh)?(coinType=bech32_1.default.toWords(coinType.slice(2)),coinType.unshift(hexBytes),bech32_1.default.encode(coinInfo.prefix,coinType)):null};Resolver.prototype.getAddress=function(coinType){return __awaiter(this,void 0,void 0,function(){var result,error_2,hexBytes,address;return __generator(this,
function(_a){switch(_a.label){case 0:null==coinType&&(coinType=60);if(60!==coinType)return[3,4];_a.label=1;case 1:return _a.trys.push([1,3,,4]),[4,this._fetch("0x3b3b57de")];case 2:return result=_a.sent(),"0x"===result||result===constants_1.HashZero?[2,null]:[2,this.provider.formatter.callAddress(result)];case 3:error_2=_a.sent();if(error_2.code===logger_1.Logger.errors.CALL_EXCEPTION)return[2,null];throw error_2;case 4:return[4,this._fetchBytes("0xf1cb7e06",bytes32ify(coinType))];case 5:hexBytes=
_a.sent();if(null==hexBytes||"0x"===hexBytes)return[2,null];address=this._getAddress(coinType,hexBytes);null==address&&logger.throwError("invalid or unsupported coin data",logger_1.Logger.errors.UNSUPPORTED_OPERATION,{operation:"getAddress("+coinType+")",coinType,data:hexBytes});return[2,address]}})})};Resolver.prototype.getAvatar=function(){return __awaiter(this,void 0,void 0,function(){var linkage,avatar,i,match,scheme,_a,selector,owner,_b,comps,addr,tokenId,tokenOwner,_c,_d,balance,_e,_f,tx,metadataUrl,
_g,metadata,imageUrl,ipfs;return __generator(this,function(_h){switch(_h.label){case 0:linkage=[{type:"name",content:this.name}],_h.label=1;case 1:return _h.trys.push([1,19,,20]),[4,this.getText("avatar")];case 2:avatar=_h.sent();if(null==avatar)return[2,null];i=0;_h.label=3;case 3:if(!(i<matchers.length))return[3,18];match=avatar.match(matchers[i]);if(null==match)return[3,17];_a=scheme=match[1].toLowerCase();switch(_a){case "https":return[3,4];case "data":return[3,5];case "ipfs":return[3,6];case "erc721":return[3,
7];case "erc1155":return[3,7]}return[3,17];case 4:return linkage.push({type:"url",content:avatar}),[2,{linkage,url:avatar}];case 5:return linkage.push({type:"data",content:avatar}),[2,{linkage,url:avatar}];case 6:return linkage.push({type:"ipfs",content:avatar}),[2,{linkage,url:getIpfsLink(avatar)}];case 7:return selector="erc721"===scheme?"0xc87b56dd":"0x0e89341c",linkage.push({type:scheme,content:avatar}),(_b=this._resolvedAddress)?[3,9]:[4,this.getAddress()];case 8:_b=_h.sent(),_h.label=9;case 9:return owner=
_b,comps=(match[2]||"").split("/"),2!==comps.length?[2,null]:[4,this.provider.formatter.address(comps[0])];case 10:addr=_h.sent();tokenId=(0,bytes_1.hexZeroPad)(bignumber_1.BigNumber.from(comps[1]).toHexString(),32);if("erc721"!==scheme)return[3,12];_d=(_c=this.provider.formatter).callAddress;return[4,this.provider.call({to:addr,data:(0,bytes_1.hexConcat)(["0x6352211e",tokenId])})];case 11:tokenOwner=_d.apply(_c,[_h.sent()]);if(owner!==tokenOwner)return[2,null];linkage.push({type:"owner",content:tokenOwner});
return[3,14];case 12:if("erc1155"!==scheme)return[3,14];_f=(_e=bignumber_1.BigNumber).from;return[4,this.provider.call({to:addr,data:(0,bytes_1.hexConcat)(["0x00fdd58e",(0,bytes_1.hexZeroPad)(owner,32),tokenId])})];case 13:balance=_f.apply(_e,[_h.sent()]);if(balance.isZero())return[2,null];linkage.push({type:"balance",content:balance.toString()});_h.label=14;case 14:return tx={to:this.provider.formatter.address(comps[0]),data:(0,bytes_1.hexConcat)([selector,tokenId])},_g=_parseString,[4,this.provider.call(tx)];
case 15:metadataUrl=_g.apply(void 0,[_h.sent(),0]);if(null==metadataUrl)return[2,null];linkage.push({type:"metadata-url-base",content:metadataUrl});"erc1155"===scheme&&(metadataUrl=metadataUrl.replace("{id}",tokenId.substring(2)),linkage.push({type:"metadata-url-expanded",content:metadataUrl}));metadataUrl.match(/^ipfs:/i)&&(metadataUrl=getIpfsLink(metadataUrl));linkage.push({type:"metadata-url",content:metadataUrl});return[4,(0,web_1.fetchJson)(metadataUrl)];case 16:metadata=_h.sent();if(!metadata)return[2,
null];linkage.push({type:"metadata",content:JSON.stringify(metadata)});imageUrl=metadata.image;if("string"!==typeof imageUrl)return[2,null];if(!imageUrl.match(/^(https:\/\/|data:)/i)){ipfs=imageUrl.match(matcherIpfs);if(null==ipfs)return[2,null];linkage.push({type:"url-ipfs",content:imageUrl});imageUrl=getIpfsLink(imageUrl)}linkage.push({type:"url",content:imageUrl});return[2,{linkage,url:imageUrl}];case 17:return i++,[3,3];case 18:return[3,20];case 19:return _h.sent(),[3,20];case 20:return[2,null]}})})};
Resolver.prototype.getContentHash=function(){return __awaiter(this,void 0,void 0,function(){var hexBytes,ipfs,length_4,ipns,length_5,swarm,skynet,urlSafe_1,hash;return __generator(this,function(_a){switch(_a.label){case 0:return[4,this._fetchBytes("0xbc1c58d1")];case 1:hexBytes=_a.sent();if(null==hexBytes||"0x"===hexBytes)return[2,null];if(ipfs=hexBytes.match(/^0xe3010170(([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f]*))$/))if(length_4=parseInt(ipfs[3],16),ipfs[4].length===2*length_4)return[2,"ipfs://"+
basex_1.Base58.encode("0x"+ipfs[1])];if(ipns=hexBytes.match(/^0xe5010172(([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f]*))$/))if(length_5=parseInt(ipns[3],16),ipns[4].length===2*length_5)return[2,"ipns://"+basex_1.Base58.encode("0x"+ipns[1])];return(swarm=hexBytes.match(/^0xe40101fa011b20([0-9a-f]*)$/))&&64===swarm[1].length?[2,"bzz://"+swarm[1]]:(skynet=hexBytes.match(/^0x90b2c605([0-9a-f]*)$/))&&68===skynet[1].length?(urlSafe_1={"\x3d":"","+":"-","/":"_"},hash=(0,base64_1.encode)("0x"+skynet[1]).replace(/[=+\/]/g,
function(a){return urlSafe_1[a]}),[2,"sia://"+hash]):[2,logger.throwError("invalid or unsupported content hash data",logger_1.Logger.errors.UNSUPPORTED_OPERATION,{operation:"getContentHash()",data:hexBytes})]}})})};Resolver.prototype.getText=function(key){return __awaiter(this,void 0,void 0,function(){var keyBytes,hexBytes;return __generator(this,function(_a){switch(_a.label){case 0:return keyBytes=(0,strings_1.toUtf8Bytes)(key),keyBytes=(0,bytes_1.concat)([bytes32ify(64),bytes32ify(keyBytes.length),
keyBytes]),0!==keyBytes.length%32&&(keyBytes=(0,bytes_1.concat)([keyBytes,(0,bytes_1.hexZeroPad)("0x",32-key.length%32)])),[4,this._fetchBytes("0x59d1d43c",(0,bytes_1.hexlify)(keyBytes))];case 1:return hexBytes=_a.sent(),null==hexBytes||"0x"===hexBytes?[2,null]:[2,(0,strings_1.toUtf8String)(hexBytes)]}})})};return Resolver}();exports.Resolver=Resolver;var defaultFormatter=null,nextPollId=1;require=function(_super){function BaseProvider(network){var _newTarget=this.constructor,_this=_super.call(this)||
this;_this._events=[];_this._emitted={block:-2};_this.disableCcipRead=!1;_this.formatter=_newTarget.getFormatter();(0,properties_1.defineReadOnly)(_this,"anyNetwork","any"===network);_this.anyNetwork&&(network=_this.detectNetwork());network instanceof Promise?(_this._networkPromise=network,network.catch(function(error){}),_this._ready().catch(function(error){})):(_newTarget=(0,properties_1.getStatic)(_newTarget,"getNetwork")(network))?((0,properties_1.defineReadOnly)(_this,"_network",_newTarget),
_this.emit("network",_newTarget,null)):logger.throwArgumentError("invalid network","network",network);_this._maxInternalBlockNumber=-1024;_this._lastBlockNumber=-2;_this._maxFilterBlockRange=10;_this._pollingInterval=4E3;_this._fastQueryDate=0;return _this}__extends(BaseProvider,_super);BaseProvider.prototype._ready=function(){return __awaiter(this,void 0,void 0,function(){var network;return __generator(this,function(_a){switch(_a.label){case 0:if(null!=this._network)return[3,7];network=null;if(!this._networkPromise)return[3,
4];_a.label=1;case 1:return _a.trys.push([1,3,,4]),[4,this._networkPromise];case 2:return network=_a.sent(),[3,4];case 3:return _a.sent(),[3,4];case 4:return null!=network?[3,6]:[4,this.detectNetwork()];case 5:network=_a.sent(),_a.label=6;case 6:network||logger.throwError("no network detected",logger_1.Logger.errors.UNKNOWN_ERROR,{}),null==this._network&&(this.anyNetwork?this._network=network:(0,properties_1.defineReadOnly)(this,"_network",network),this.emit("network",network,null)),_a.label=7;case 7:return[2,
this._network]}})})};Object.defineProperty(BaseProvider.prototype,"ready",{get:function(){var _this=this;return(0,web_1.poll)(function(){return _this._ready().then(function(network){return network},function(error){if(error.code!==logger_1.Logger.errors.NETWORK_ERROR||"noNetwork"!==error.event)throw error;})})},enumerable:!1,configurable:!0});BaseProvider.getFormatter=function(){null==defaultFormatter&&(defaultFormatter=new formatter_1.Formatter);return defaultFormatter};BaseProvider.getNetwork=function(network){return(0,networks_1.getNetwork)(null==
network?"homestead":network)};BaseProvider.prototype.ccipReadFetch=function(tx,calldata,urls){return __awaiter(this,void 0,void 0,function(){var sender,data,errorMessages,i,url,href,json,result,errorMessage;return __generator(this,function(_a){switch(_a.label){case 0:if(this.disableCcipRead||0===urls.length)return[2,null];sender=tx.to.toLowerCase();data=calldata.toLowerCase();errorMessages=[];i=0;_a.label=1;case 1:if(!(i<urls.length))return[3,4];url=urls[i];href=url.replace("{sender}",sender).replace("{data}",
data);json=0<=url.indexOf("{data}")?null:JSON.stringify({data,sender});return[4,(0,web_1.fetchJson)({url:href,errorPassThrough:!0},json,function(value,response){value.status=response.statusCode;return value})];case 2:result=_a.sent();if(result.data)return[2,result.data];errorMessage=result.message||"unknown error";if(400<=result.status&&500>result.status)return[2,logger.throwError("response not found during CCIP fetch: "+errorMessage,logger_1.Logger.errors.SERVER_ERROR,{url,errorMessage})];errorMessages.push(errorMessage);
_a.label=3;case 3:return i++,[3,1];case 4:return[2,logger.throwError("error encountered during CCIP fetch: "+errorMessages.map(function(m){return JSON.stringify(m)}).join(", "),logger_1.Logger.errors.SERVER_ERROR,{urls,errorMessages})]}})})};BaseProvider.prototype._getInternalBlockNumber=function(maxAge){return __awaiter(this,void 0,void 0,function(){var internalBlockNumber,result,reqTime,checkInternalBlockNumber,_this=this;return __generator(this,function(_a$jscomp$0){switch(_a$jscomp$0.label){case 0:return[4,
this._ready()];case 1:_a$jscomp$0.sent();if(!(0<maxAge))return[3,7];_a$jscomp$0.label=2;case 2:if(!this._internalBlockNumber)return[3,7];internalBlockNumber=this._internalBlockNumber;_a$jscomp$0.label=3;case 3:return _a$jscomp$0.trys.push([3,5,,6]),[4,internalBlockNumber];case 4:return result=_a$jscomp$0.sent(),getTime()-result.respTime<=maxAge?[2,result.blockNumber]:[3,7];case 5:return _a$jscomp$0.sent(),this._internalBlockNumber===internalBlockNumber?[3,7]:[3,6];case 6:return[3,2];case 7:return reqTime=
getTime(),this._internalBlockNumber=checkInternalBlockNumber=(0,properties_1.resolveProperties)({blockNumber:this.perform("getBlockNumber",{}),networkError:this.getNetwork().then(function(network){return null},function(error){return error})}).then(function(_a){var blockNumber=_a.blockNumber;if(_a=_a.networkError)throw _this._internalBlockNumber===checkInternalBlockNumber&&(_this._internalBlockNumber=null),_a;_a=getTime();blockNumber=bignumber_1.BigNumber.from(blockNumber).toNumber();blockNumber<_this._maxInternalBlockNumber&&
(blockNumber=_this._maxInternalBlockNumber);_this._maxInternalBlockNumber=blockNumber;_this._setFastBlockNumber(blockNumber);return{blockNumber,reqTime,respTime:_a}}),checkInternalBlockNumber.catch(function(error){_this._internalBlockNumber===checkInternalBlockNumber&&(_this._internalBlockNumber=null)}),[4,checkInternalBlockNumber];case 8:return[2,_a$jscomp$0.sent().blockNumber]}})})};BaseProvider.prototype.poll=function(){return __awaiter(this,void 0,void 0,function(){var pollId,runners,blockNumber,
error_6,i,_this=this;return __generator(this,function(_a){switch(_a.label){case 0:pollId=nextPollId++,runners=[],blockNumber=null,_a.label=1;case 1:return _a.trys.push([1,3,,4]),[4,this._getInternalBlockNumber(100+this.pollingInterval/2)];case 2:return blockNumber=_a.sent(),[3,4];case 3:return error_6=_a.sent(),this.emit("error",error_6),[2];case 4:this._setFastBlockNumber(blockNumber);this.emit("poll",pollId,blockNumber);if(blockNumber===this._lastBlockNumber)return this.emit("didPoll",pollId),[2];
-2===this._emitted.block&&(this._emitted.block=blockNumber-1);if(1E3<Math.abs(this._emitted.block-blockNumber))logger.warn("network block skew detected; skipping block events (emitted\x3d"+this._emitted.block+" blockNumber"+blockNumber+")"),this.emit("error",logger.makeError("network block skew detected",logger_1.Logger.errors.NETWORK_ERROR,{blockNumber,event:"blockSkew",previousBlockNumber:this._emitted.block})),this.emit("block",blockNumber);else for(i=this._emitted.block+1;i<=blockNumber;i++)this.emit("block",
i);this._emitted.block!==blockNumber&&(this._emitted.block=blockNumber,Object.keys(this._emitted).forEach(function(key){if("block"!==key){var eventBlockNumber=_this._emitted[key];"pending"!==eventBlockNumber&&12<blockNumber-eventBlockNumber&&delete _this._emitted[key]}}));-2===this._lastBlockNumber&&(this._lastBlockNumber=blockNumber-1);this._events.forEach(function(event){switch(event.type){case "tx":var hash_2=event.hash,runner=_this.getTransactionReceipt(hash_2).then(function(receipt){if(!receipt||
null==receipt.blockNumber)return null;_this._emitted["t:"+hash_2]=receipt.blockNumber;_this.emit(hash_2,receipt);return null}).catch(function(error){_this.emit("error",error)});runners.push(runner);break;case "filter":if(!event._inflight){event._inflight=!0;-2===event._lastBlockNumber&&(event._lastBlockNumber=blockNumber-1);var filter_1=event.filter;filter_1.fromBlock=event._lastBlockNumber+1;filter_1.toBlock=blockNumber;runner=filter_1.toBlock-_this._maxFilterBlockRange;runner>filter_1.fromBlock&&
(filter_1.fromBlock=runner);0>filter_1.fromBlock&&(filter_1.fromBlock=0);runner=_this.getLogs(filter_1).then(function(logs){event._inflight=!1;0!==logs.length&&logs.forEach(function(log){log.blockNumber>event._lastBlockNumber&&(event._lastBlockNumber=log.blockNumber);_this._emitted["b:"+log.blockHash]=log.blockNumber;_this._emitted["t:"+log.transactionHash]=log.blockNumber;_this.emit(filter_1,log)})}).catch(function(error){_this.emit("error",error);event._inflight=!1});runners.push(runner)}}});this._lastBlockNumber=
blockNumber;Promise.all(runners).then(function(){_this.emit("didPoll",pollId)}).catch(function(error){_this.emit("error",error)});return[2]}})})};BaseProvider.prototype.resetEventsBlock=function(blockNumber){this._lastBlockNumber=blockNumber-1;this.polling&&this.poll()};Object.defineProperty(BaseProvider.prototype,"network",{get:function(){return this._network},enumerable:!1,configurable:!0});BaseProvider.prototype.detectNetwork=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,
function(_a){return[2,logger.throwError("provider does not support network detection",logger_1.Logger.errors.UNSUPPORTED_OPERATION,{operation:"provider.detectNetwork"})]})})};BaseProvider.prototype.getNetwork=function(){return __awaiter(this,void 0,void 0,function(){var network,currentNetwork,error;return __generator(this,function(_a){switch(_a.label){case 0:return[4,this._ready()];case 1:return network=_a.sent(),[4,this.detectNetwork()];case 2:currentNetwork=_a.sent();if(network.chainId===currentNetwork.chainId)return[3,
5];if(!this.anyNetwork)return[3,4];this._network=currentNetwork;this._lastBlockNumber=-2;this._fastBlockNumberPromise=this._fastBlockNumber=null;this._fastQueryDate=0;this._emitted.block=-2;this._maxInternalBlockNumber=-1024;this._internalBlockNumber=null;this.emit("network",currentNetwork,network);return[4,stall(0)];case 3:return _a.sent(),[2,this._network];case 4:throw error=logger.makeError("underlying network changed",logger_1.Logger.errors.NETWORK_ERROR,{event:"changed",network,detectedNetwork:currentNetwork}),
this.emit("error",error),error;case 5:return[2,network]}})})};Object.defineProperty(BaseProvider.prototype,"blockNumber",{get:function(){var _this=this;this._getInternalBlockNumber(100+this.pollingInterval/2).then(function(blockNumber){_this._setFastBlockNumber(blockNumber)},function(error){});return null!=this._fastBlockNumber?this._fastBlockNumber:-1},enumerable:!1,configurable:!0});Object.defineProperty(BaseProvider.prototype,"polling",{get:function(){return null!=this._poller},set:function(value){var _this=
this;value&&!this._poller?(this._poller=setInterval(function(){_this.poll()},this.pollingInterval),this._bootstrapPoll||(this._bootstrapPoll=setTimeout(function(){_this.poll();_this._bootstrapPoll=setTimeout(function(){_this._poller||_this.poll();_this._bootstrapPoll=null},_this.pollingInterval)},0))):!value&&this._poller&&(clearInterval(this._poller),this._poller=null)},enumerable:!1,configurable:!0});Object.defineProperty(BaseProvider.prototype,"pollingInterval",{get:function(){return this._pollingInterval},
set:function(value){var _this=this;if("number"!==typeof value||0>=value||parseInt(String(value))!=value)throw Error("invalid polling interval");this._pollingInterval=value;this._poller&&(clearInterval(this._poller),this._poller=setInterval(function(){_this.poll()},this._pollingInterval))},enumerable:!1,configurable:!0});BaseProvider.prototype._getFastBlockNumber=function(){var _this=this,now=getTime();now-this._fastQueryDate>2*this._pollingInterval&&(this._fastQueryDate=now,this._fastBlockNumberPromise=
this.getBlockNumber().then(function(blockNumber){if(null==_this._fastBlockNumber||blockNumber>_this._fastBlockNumber)_this._fastBlockNumber=blockNumber;return _this._fastBlockNumber}));return this._fastBlockNumberPromise};BaseProvider.prototype._setFastBlockNumber=function(blockNumber){!(null!=this._fastBlockNumber&&blockNumber<this._fastBlockNumber)&&(this._fastQueryDate=getTime(),null==this._fastBlockNumber||blockNumber>this._fastBlockNumber)&&(this._fastBlockNumber=blockNumber,this._fastBlockNumberPromise=
Promise.resolve(blockNumber))};BaseProvider.prototype.waitForTransaction=function(transactionHash,confirmations,timeout){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,this._waitForTransaction(transactionHash,null==confirmations?1:confirmations,timeout||0,null)]})})};BaseProvider.prototype._waitForTransaction=function(transactionHash,confirmations,timeout,replaceable){return __awaiter(this,void 0,void 0,function(){var receipt$jscomp$0,_this$jscomp$0=this;
return __generator(this,function(_a$jscomp$1){switch(_a$jscomp$1.label){case 0:return[4,this.getTransactionReceipt(transactionHash)];case 1:return receipt$jscomp$0=_a$jscomp$1.sent(),(receipt$jscomp$0?receipt$jscomp$0.confirmations:0)>=confirmations?[2,receipt$jscomp$0]:[2,new Promise(function(resolve,reject){var cancelFuncs=[],done=!1,alreadyDone=function(){if(done)return!0;done=!0;cancelFuncs.forEach(function(func){func()});return!1},minedHandler=function(receipt){receipt.confirmations<confirmations||
alreadyDone()||resolve(receipt)};_this$jscomp$0.on(transactionHash,minedHandler);cancelFuncs.push(function(){_this$jscomp$0.removeListener(transactionHash,minedHandler)});if(replaceable){var lastBlockNumber_1=replaceable.startBlock,scannedBlock_1=null,replaceHandler_1=function(blockNumber){return __awaiter(_this$jscomp$0,void 0,void 0,function(){var _this=this;return __generator(this,function(_a$jscomp$0){switch(_a$jscomp$0.label){case 0:return done?[2]:[4,stall(1E3)];case 1:return _a$jscomp$0.sent(),
this.getTransactionCount(replaceable.from).then(function(nonce){return __awaiter(_this,void 0,void 0,function(){var mined,block,ti,tx,receipt_1,reason;return __generator(this,function(_a){switch(_a.label){case 0:if(done)return[2];if(!(nonce<=replaceable.nonce))return[3,1];lastBlockNumber_1=blockNumber;return[3,9];case 1:return[4,this.getTransaction(transactionHash)];case 2:if((mined=_a.sent())&&null!=mined.blockNumber)return[2];null==scannedBlock_1&&(scannedBlock_1=lastBlockNumber_1-3,scannedBlock_1<
replaceable.startBlock&&(scannedBlock_1=replaceable.startBlock));_a.label=3;case 3:return scannedBlock_1<=blockNumber?done?[2]:[4,this.getBlockWithTransactions(scannedBlock_1)]:[3,9];case 4:block=_a.sent(),ti=0,_a.label=5;case 5:if(!(ti<block.transactions.length))return[3,8];tx=block.transactions[ti];return tx.hash===transactionHash?[2]:tx.from!==replaceable.from||tx.nonce!==replaceable.nonce?[3,7]:done?[2]:[4,this.waitForTransaction(tx.hash,confirmations)];case 6:receipt_1=_a.sent();if(alreadyDone())return[2];
reason="replaced";tx.data===replaceable.data&&tx.to===replaceable.to&&tx.value.eq(replaceable.value)?reason="repriced":"0x"===tx.data&&tx.from===tx.to&&tx.value.isZero()&&(reason="cancelled");reject(logger.makeError("transaction was replaced",logger_1.Logger.errors.TRANSACTION_REPLACED,{cancelled:"replaced"===reason||"cancelled"===reason,reason,replacement:this._wrapTransaction(tx),hash:transactionHash,receipt:receipt_1}));return[2];case 7:return ti++,[3,5];case 8:return scannedBlock_1++,[3,3];case 9:if(done)return[2];
this.once("block",replaceHandler_1);return[2]}})})},function(error){if(!done)_this.once("block",replaceHandler_1)}),[2]}})})};if(done)return;_this$jscomp$0.once("block",replaceHandler_1);cancelFuncs.push(function(){_this$jscomp$0.removeListener("block",replaceHandler_1)})}if("number"===typeof timeout&&0<timeout){var timer_1=setTimeout(function(){alreadyDone()||reject(logger.makeError("timeout exceeded",logger_1.Logger.errors.TIMEOUT,{timeout}))},timeout);timer_1.unref&&timer_1.unref();cancelFuncs.push(function(){clearTimeout(timer_1)})}})]}})})};
BaseProvider.prototype.getBlockNumber=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,this._getInternalBlockNumber(0)]})})};BaseProvider.prototype.getGasPrice=function(){return __awaiter(this,void 0,void 0,function(){var result;return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.getNetwork()];case 1:return _a.sent(),[4,this.perform("getGasPrice",{})];case 2:result=_a.sent();try{return[2,bignumber_1.BigNumber.from(result)]}catch(error){return[2,
logger.throwError("bad result from backend",logger_1.Logger.errors.SERVER_ERROR,{method:"getGasPrice",result,error})]}}})})};BaseProvider.prototype.getBalance=function(addressOrName,blockTag){return __awaiter(this,void 0,void 0,function(){var params,result;return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.getNetwork()];case 1:return _a.sent(),[4,(0,properties_1.resolveProperties)({address:this._getAddress(addressOrName),blockTag:this._getBlockTag(blockTag)})];case 2:return params=
_a.sent(),[4,this.perform("getBalance",params)];case 3:result=_a.sent();try{return[2,bignumber_1.BigNumber.from(result)]}catch(error){return[2,logger.throwError("bad result from backend",logger_1.Logger.errors.SERVER_ERROR,{method:"getBalance",params,result,error})]}}})})};BaseProvider.prototype.getTransactionCount=function(addressOrName,blockTag){return __awaiter(this,void 0,void 0,function(){var params,result;return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.getNetwork()];
case 1:return _a.sent(),[4,(0,properties_1.resolveProperties)({address:this._getAddress(addressOrName),blockTag:this._getBlockTag(blockTag)})];case 2:return params=_a.sent(),[4,this.perform("getTransactionCount",params)];case 3:result=_a.sent();try{return[2,bignumber_1.BigNumber.from(result).toNumber()]}catch(error){return[2,logger.throwError("bad result from backend",logger_1.Logger.errors.SERVER_ERROR,{method:"getTransactionCount",params,result,error})]}}})})};BaseProvider.prototype.getCode=function(addressOrName,
blockTag){return __awaiter(this,void 0,void 0,function(){var params,result;return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.getNetwork()];case 1:return _a.sent(),[4,(0,properties_1.resolveProperties)({address:this._getAddress(addressOrName),blockTag:this._getBlockTag(blockTag)})];case 2:return params=_a.sent(),[4,this.perform("getCode",params)];case 3:result=_a.sent();try{return[2,(0,bytes_1.hexlify)(result)]}catch(error){return[2,logger.throwError("bad result from backend",
logger_1.Logger.errors.SERVER_ERROR,{method:"getCode",params,result,error})]}}})})};BaseProvider.prototype.getStorageAt=function(addressOrName,position,blockTag){return __awaiter(this,void 0,void 0,function(){var params,result;return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.getNetwork()];case 1:return _a.sent(),[4,(0,properties_1.resolveProperties)({address:this._getAddress(addressOrName),blockTag:this._getBlockTag(blockTag),position:Promise.resolve(position).then(function(p){return(0,bytes_1.hexValue)(p)})})];
case 2:return params=_a.sent(),[4,this.perform("getStorageAt",params)];case 3:result=_a.sent();try{return[2,(0,bytes_1.hexlify)(result)]}catch(error){return[2,logger.throwError("bad result from backend",logger_1.Logger.errors.SERVER_ERROR,{method:"getStorageAt",params,result,error})]}}})})};BaseProvider.prototype._wrapTransaction=function(tx,hash,startBlock){var _this=this;if(null!=hash&&32!==(0,bytes_1.hexDataLength)(hash))throw Error("invalid response - sendTransaction");null!=hash&&tx.hash!==hash&&
logger.throwError("Transaction hash mismatch from Provider.sendTransaction.",logger_1.Logger.errors.UNKNOWN_ERROR,{expectedHash:tx.hash,returnedHash:hash});tx.wait=function(confirms,timeout){return __awaiter(_this,void 0,void 0,function(){var replacement,receipt;return __generator(this,function(_a){switch(_a.label){case 0:return null==confirms&&(confirms=1),null==timeout&&(timeout=0),replacement=void 0,0!==confirms&&null!=startBlock&&(replacement={data:tx.data,from:tx.from,nonce:tx.nonce,to:tx.to,
value:tx.value,startBlock}),[4,this._waitForTransaction(tx.hash,confirms,timeout,replacement)];case 1:receipt=_a.sent();if(null==receipt&&0===confirms)return[2,null];this._emitted["t:"+tx.hash]=receipt.blockNumber;0===receipt.status&&logger.throwError("transaction failed",logger_1.Logger.errors.CALL_EXCEPTION,{transactionHash:tx.hash,transaction:tx,receipt});return[2,receipt]}})})};return tx};BaseProvider.prototype.sendTransaction=function(signedTransaction){return __awaiter(this,void 0,void 0,function(){var hexTx,
tx,blockNumber,hash,error_7;return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.getNetwork()];case 1:return _a.sent(),[4,Promise.resolve(signedTransaction).then(function(t){return(0,bytes_1.hexlify)(t)})];case 2:return hexTx=_a.sent(),tx=this.formatter.transaction(signedTransaction),null==tx.confirmations&&(tx.confirmations=0),[4,this._getInternalBlockNumber(100+2*this.pollingInterval)];case 3:blockNumber=_a.sent(),_a.label=4;case 4:return _a.trys.push([4,6,,7]),[4,this.perform("sendTransaction",
{signedTransaction:hexTx})];case 5:return hash=_a.sent(),[2,this._wrapTransaction(tx,hash,blockNumber)];case 6:throw error_7=_a.sent(),error_7.transaction=tx,error_7.transactionHash=tx.hash,error_7;case 7:return[2]}})})};BaseProvider.prototype._getTransactionRequest=function(transaction){return __awaiter(this,void 0,void 0,function(){var values,tx,_a,_b,_this=this;return __generator(this,function(_c){switch(_c.label){case 0:return[4,transaction];case 1:return values=_c.sent(),tx={},["from","to"].forEach(function(key){null!=
values[key]&&(tx[key]=Promise.resolve(values[key]).then(function(v){return v?_this._getAddress(v):null}))}),["gasLimit","gasPrice","maxFeePerGas","maxPriorityFeePerGas","value"].forEach(function(key){null!=values[key]&&(tx[key]=Promise.resolve(values[key]).then(function(v){return v?bignumber_1.BigNumber.from(v):null}))}),["type"].forEach(function(key){null!=values[key]&&(tx[key]=Promise.resolve(values[key]).then(function(v){return null!=v?v:null}))}),values.accessList&&(tx.accessList=this.formatter.accessList(values.accessList)),
["data"].forEach(function(key){null!=values[key]&&(tx[key]=Promise.resolve(values[key]).then(function(v){return v?(0,bytes_1.hexlify)(v):null}))}),_b=(_a=this.formatter).transactionRequest,[4,(0,properties_1.resolveProperties)(tx)];case 2:return[2,_b.apply(_a,[_c.sent()])]}})})};BaseProvider.prototype._getFilter=function(filter){return __awaiter(this,void 0,void 0,function(){var result,_a,_b,_this=this;return __generator(this,function(_c){switch(_c.label){case 0:return[4,filter];case 1:return filter=
_c.sent(),result={},null!=filter.address&&(result.address=this._getAddress(filter.address)),["blockHash","topics"].forEach(function(key){null!=filter[key]&&(result[key]=filter[key])}),["fromBlock","toBlock"].forEach(function(key){null!=filter[key]&&(result[key]=_this._getBlockTag(filter[key]))}),_b=(_a=this.formatter).filter,[4,(0,properties_1.resolveProperties)(result)];case 2:return[2,_b.apply(_a,[_c.sent()])]}})})};BaseProvider.prototype._call=function(transaction,blockTag,attempt){return __awaiter(this,
void 0,void 0,function(){var txSender,result,data,sender,urls,urlsOffset,urlsLength,urlsData,u,url,calldata,callbackSelector,extraData,ccipResult,tx,error_8;return __generator(this,function(_a){switch(_a.label){case 0:return 10<=attempt&&logger.throwError("CCIP read exceeded maximum redirections",logger_1.Logger.errors.SERVER_ERROR,{redirects:attempt,transaction}),txSender=transaction.to,[4,this.perform("call",{transaction,blockTag})];case 1:result=_a.sent();if(!(0<=attempt&&"latest"===blockTag&&
null!=txSender&&"0x556f1830"===result.substring(0,10)&&4===(0,bytes_1.hexDataLength)(result)%32))return[3,5];_a.label=2;case 2:_a.trys.push([2,4,,5]);data=(0,bytes_1.hexDataSlice)(result,4);sender=(0,bytes_1.hexDataSlice)(data,0,32);bignumber_1.BigNumber.from(sender).eq(txSender)||logger.throwError("CCIP Read sender did not match",logger_1.Logger.errors.CALL_EXCEPTION,{name:"OffchainLookup",signature:"OffchainLookup(address,string[],bytes,bytes4,bytes)",transaction,data:result});urls=[];urlsOffset=
bignumber_1.BigNumber.from((0,bytes_1.hexDataSlice)(data,32,64)).toNumber();urlsLength=bignumber_1.BigNumber.from((0,bytes_1.hexDataSlice)(data,urlsOffset,urlsOffset+32)).toNumber();urlsData=(0,bytes_1.hexDataSlice)(data,urlsOffset+32);for(u=0;u<urlsLength;u++)url=_parseString(urlsData,32*u),null==url&&logger.throwError("CCIP Read contained corrupt URL string",logger_1.Logger.errors.CALL_EXCEPTION,{name:"OffchainLookup",signature:"OffchainLookup(address,string[],bytes,bytes4,bytes)",transaction,data:result}),
urls.push(url);calldata=_parseBytes(data,64);bignumber_1.BigNumber.from((0,bytes_1.hexDataSlice)(data,100,128)).isZero()||logger.throwError("CCIP Read callback selector included junk",logger_1.Logger.errors.CALL_EXCEPTION,{name:"OffchainLookup",signature:"OffchainLookup(address,string[],bytes,bytes4,bytes)",transaction,data:result});callbackSelector=(0,bytes_1.hexDataSlice)(data,96,100);extraData=_parseBytes(data,128);return[4,this.ccipReadFetch(transaction,calldata,urls)];case 3:return ccipResult=
_a.sent(),null==ccipResult&&logger.throwError("CCIP Read disabled or provided no URLs",logger_1.Logger.errors.CALL_EXCEPTION,{name:"OffchainLookup",signature:"OffchainLookup(address,string[],bytes,bytes4,bytes)",transaction,data:result}),tx={to:txSender,data:(0,bytes_1.hexConcat)([callbackSelector,encodeBytes([ccipResult,extraData])])},[2,this._call(tx,blockTag,attempt+1)];case 4:error_8=_a.sent();if(error_8.code===logger_1.Logger.errors.SERVER_ERROR)throw error_8;return[3,5];case 5:try{return[2,
(0,bytes_1.hexlify)(result)]}catch(error){return[2,logger.throwError("bad result from backend",logger_1.Logger.errors.SERVER_ERROR,{method:"call",params:{transaction,blockTag},result,error})]}}})})};BaseProvider.prototype.call=function(transaction,blockTag){return __awaiter(this,void 0,void 0,function(){var resolved;return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.getNetwork()];case 1:return _a.sent(),[4,(0,properties_1.resolveProperties)({transaction:this._getTransactionRequest(transaction),
blockTag:this._getBlockTag(blockTag),ccipReadEnabled:Promise.resolve(transaction.ccipReadEnabled)})];case 2:return resolved=_a.sent(),[2,this._call(resolved.transaction,resolved.blockTag,resolved.ccipReadEnabled?0:-1)]}})})};BaseProvider.prototype.estimateGas=function(transaction){return __awaiter(this,void 0,void 0,function(){var params,result;return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.getNetwork()];case 1:return _a.sent(),[4,(0,properties_1.resolveProperties)({transaction:this._getTransactionRequest(transaction)})];
case 2:return params=_a.sent(),[4,this.perform("estimateGas",params)];case 3:result=_a.sent();try{return[2,bignumber_1.BigNumber.from(result)]}catch(error){return[2,logger.throwError("bad result from backend",logger_1.Logger.errors.SERVER_ERROR,{method:"estimateGas",params,result,error})]}}})})};BaseProvider.prototype._getAddress=function(addressOrName){return __awaiter(this,void 0,void 0,function(){var address;return __generator(this,function(_a){switch(_a.label){case 0:return[4,addressOrName];case 1:return addressOrName=
_a.sent(),"string"!==typeof addressOrName&&logger.throwArgumentError("invalid address or ENS name","name",addressOrName),[4,this.resolveName(addressOrName)];case 2:return address=_a.sent(),null==address&&logger.throwError("ENS name not configured",logger_1.Logger.errors.UNSUPPORTED_OPERATION,{operation:"resolveName("+JSON.stringify(addressOrName)+")"}),[2,address]}})})};BaseProvider.prototype._getBlock=function(blockHashOrBlockTag,includeTransactions){return __awaiter(this,void 0,void 0,function(){var blockNumber,
params,_a$jscomp$0,_this$jscomp$0=this;return __generator(this,function(_b){switch(_b.label){case 0:return[4,this.getNetwork()];case 1:return _b.sent(),[4,blockHashOrBlockTag];case 2:blockHashOrBlockTag=_b.sent();blockNumber=-128;params={includeTransactions:!!includeTransactions};if(!(0,bytes_1.isHexString)(blockHashOrBlockTag,32))return[3,3];params.blockHash=blockHashOrBlockTag;return[3,6];case 3:return _b.trys.push([3,5,,6]),_a$jscomp$0=params,[4,this._getBlockTag(blockHashOrBlockTag)];case 4:return _a$jscomp$0.blockTag=
_b.sent(),(0,bytes_1.isHexString)(params.blockTag)&&(blockNumber=parseInt(params.blockTag.substring(2),16)),[3,6];case 5:return _b.sent(),logger.throwArgumentError("invalid block hash or block tag","blockHashOrBlockTag",blockHashOrBlockTag),[3,6];case 6:return[2,(0,web_1.poll)(function(){return __awaiter(_this$jscomp$0,void 0,void 0,function(){var block,blockNumber_1,i,tx$jscomp$0,confirmations,blockWithTxs,_this=this;return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.perform("getBlock",
params)];case 1:block=_a.sent();if(null==block)return null!=params.blockHash&&null==this._emitted["b:"+params.blockHash]||null!=params.blockTag&&blockNumber>this._emitted.block?[2,null]:[2,void 0];if(!includeTransactions)return[3,8];blockNumber_1=null;i=0;_a.label=2;case 2:if(!(i<block.transactions.length))return[3,7];tx$jscomp$0=block.transactions[i];if(null!=tx$jscomp$0.blockNumber)return[3,3];tx$jscomp$0.confirmations=0;return[3,6];case 3:return null!=tx$jscomp$0.confirmations?[3,6]:null!=blockNumber_1?
[3,5]:[4,this._getInternalBlockNumber(100+2*this.pollingInterval)];case 4:blockNumber_1=_a.sent(),_a.label=5;case 5:confirmations=blockNumber_1-tx$jscomp$0.blockNumber+1,0>=confirmations&&(confirmations=1),tx$jscomp$0.confirmations=confirmations,_a.label=6;case 6:return i++,[3,2];case 7:return blockWithTxs=this.formatter.blockWithTransactions(block),blockWithTxs.transactions=blockWithTxs.transactions.map(function(tx){return _this._wrapTransaction(tx)}),[2,blockWithTxs];case 8:return[2,this.formatter.block(block)]}})})},
{oncePoll:this})]}})})};BaseProvider.prototype.getBlock=function(blockHashOrBlockTag){return this._getBlock(blockHashOrBlockTag,!1)};BaseProvider.prototype.getBlockWithTransactions=function(blockHashOrBlockTag){return this._getBlock(blockHashOrBlockTag,!0)};BaseProvider.prototype.getTransaction=function(transactionHash){return __awaiter(this,void 0,void 0,function(){var params,_this=this;return __generator(this,function(_a$jscomp$0){switch(_a$jscomp$0.label){case 0:return[4,this.getNetwork()];case 1:return _a$jscomp$0.sent(),
[4,transactionHash];case 2:return transactionHash=_a$jscomp$0.sent(),params={transactionHash:this.formatter.hash(transactionHash,!0)},[2,(0,web_1.poll)(function(){return __awaiter(_this,void 0,void 0,function(){var result,tx,blockNumber,confirmations;return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.perform("getTransaction",params)];case 1:result=_a.sent();if(null==result)return null==this._emitted["t:"+transactionHash]?[2,null]:[2,void 0];tx=this.formatter.transactionResponse(result);
if(null!=tx.blockNumber)return[3,2];tx.confirmations=0;return[3,4];case 2:return null!=tx.confirmations?[3,4]:[4,this._getInternalBlockNumber(100+2*this.pollingInterval)];case 3:blockNumber=_a.sent(),confirmations=blockNumber-tx.blockNumber+1,0>=confirmations&&(confirmations=1),tx.confirmations=confirmations,_a.label=4;case 4:return[2,this._wrapTransaction(tx)]}})})},{oncePoll:this})]}})})};BaseProvider.prototype.getTransactionReceipt=function(transactionHash){return __awaiter(this,void 0,void 0,
function(){var params,_this=this;return __generator(this,function(_a$jscomp$0){switch(_a$jscomp$0.label){case 0:return[4,this.getNetwork()];case 1:return _a$jscomp$0.sent(),[4,transactionHash];case 2:return transactionHash=_a$jscomp$0.sent(),params={transactionHash:this.formatter.hash(transactionHash,!0)},[2,(0,web_1.poll)(function(){return __awaiter(_this,void 0,void 0,function(){var result,receipt,blockNumber,confirmations;return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.perform("getTransactionReceipt",
params)];case 1:result=_a.sent();if(null==result)return null==this._emitted["t:"+transactionHash]?[2,null]:[2,void 0];if(null==result.blockHash)return[2,void 0];receipt=this.formatter.receipt(result);if(null!=receipt.blockNumber)return[3,2];receipt.confirmations=0;return[3,4];case 2:return null!=receipt.confirmations?[3,4]:[4,this._getInternalBlockNumber(100+2*this.pollingInterval)];case 3:blockNumber=_a.sent(),confirmations=blockNumber-receipt.blockNumber+1,0>=confirmations&&(confirmations=1),receipt.confirmations=
confirmations,_a.label=4;case 4:return[2,receipt]}})})},{oncePoll:this})]}})})};BaseProvider.prototype.getLogs=function(filter){return __awaiter(this,void 0,void 0,function(){var params,logs;return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.getNetwork()];case 1:return _a.sent(),[4,(0,properties_1.resolveProperties)({filter:this._getFilter(filter)})];case 2:return params=_a.sent(),[4,this.perform("getLogs",params)];case 3:return logs=_a.sent(),logs.forEach(function(log){null==
log.removed&&(log.removed=!1)}),[2,formatter_1.Formatter.arrayOf(this.formatter.filterLog.bind(this.formatter))(logs)]}})})};BaseProvider.prototype.getEtherPrice=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.getNetwork()];case 1:return _a.sent(),[2,this.perform("getEtherPrice",{})]}})})};BaseProvider.prototype._getBlockTag=function(blockTag){return __awaiter(this,void 0,void 0,function(){var blockNumber;return __generator(this,
function(_a){switch(_a.label){case 0:return[4,blockTag];case 1:blockTag=_a.sent();if(!("number"===typeof blockTag&&0>blockTag))return[3,3];blockTag%1&&logger.throwArgumentError("invalid BlockTag","blockTag",blockTag);return[4,this._getInternalBlockNumber(100+2*this.pollingInterval)];case 2:return blockNumber=_a.sent(),blockNumber+=blockTag,0>blockNumber&&(blockNumber=0),[2,this.formatter.blockTag(blockNumber)];case 3:return[2,this.formatter.blockTag(blockTag)]}})})};BaseProvider.prototype.getResolver=
function(name){return __awaiter(this,void 0,void 0,function(){var currentName,addr,resolver,_a;return __generator(this,function(_b){switch(_b.label){case 0:currentName=name,_b.label=1;case 1:return""===currentName||"."===currentName||"eth"!==name&&"eth"===currentName?[2,null]:[4,this._getResolver(currentName,"getResolver")];case 2:addr=_b.sent();if(null==addr)return[3,5];resolver=new Resolver(this,addr,name);return(_a=currentName!==name)?[4,resolver.supportsWildcard()]:[3,4];case 3:_a=!_b.sent(),
_b.label=4;case 4:return _a?[2,null]:[2,resolver];case 5:return currentName=currentName.split(".").slice(1).join("."),[3,1];case 6:return[2]}})})};BaseProvider.prototype._getResolver=function(name,operation){return __awaiter(this,void 0,void 0,function(){var network,addrData;return __generator(this,function(_a){switch(_a.label){case 0:return null==operation&&(operation="ENS"),[4,this.getNetwork()];case 1:network=_a.sent(),network.ensAddress||logger.throwError("network does not support ENS",logger_1.Logger.errors.UNSUPPORTED_OPERATION,
{operation,network:network.name}),_a.label=2;case 2:return _a.trys.push([2,4,,5]),[4,this.call({to:network.ensAddress,data:"0x0178b8bf"+(0,hash_1.namehash)(name).substring(2)})];case 3:return addrData=_a.sent(),[2,this.formatter.callAddress(addrData)];case 4:return _a.sent(),[3,5];case 5:return[2,null]}})})};BaseProvider.prototype.resolveName=function(name){return __awaiter(this,void 0,void 0,function(){var resolver;return __generator(this,function(_a){switch(_a.label){case 0:return[4,name];case 1:name=
_a.sent();try{return[2,Promise.resolve(this.formatter.address(name))]}catch(error){if((0,bytes_1.isHexString)(name))throw error;}"string"!==typeof name&&logger.throwArgumentError("invalid ENS name","name",name);return[4,this.getResolver(name)];case 2:return(resolver=_a.sent())?[4,resolver.getAddress()]:[2,null];case 3:return[2,_a.sent()]}})})};BaseProvider.prototype.lookupAddress=function(address){return __awaiter(this,void 0,void 0,function(){var node,resolverAddr,name,_a,addr;return __generator(this,
function(_b){switch(_b.label){case 0:return[4,address];case 1:return address=_b.sent(),address=this.formatter.address(address),node=address.substring(2).toLowerCase()+".addr.reverse",[4,this._getResolver(node,"lookupAddress")];case 2:resolverAddr=_b.sent();if(null==resolverAddr)return[2,null];_a=_parseString;return[4,this.call({to:resolverAddr,data:"0x691f3431"+(0,hash_1.namehash)(node).substring(2)})];case 3:return name=_a.apply(void 0,[_b.sent(),0]),[4,this.resolveName(name)];case 4:return addr=
_b.sent(),addr!=address?[2,null]:[2,name]}})})};BaseProvider.prototype.getAvatar=function(nameOrAddress){return __awaiter(this,void 0,void 0,function(){var resolver,address,node,resolverAddress,avatar_1,error_11,name_1,_a,error_12,avatar;return __generator(this,function(_b){switch(_b.label){case 0:resolver=null;if(!(0,bytes_1.isHexString)(nameOrAddress))return[3,10];address=this.formatter.address(nameOrAddress);node=address.substring(2).toLowerCase()+".addr.reverse";return[4,this._getResolver(node,
"getAvatar")];case 1:resolverAddress=_b.sent();if(!resolverAddress)return[2,null];resolver=new Resolver(this,resolverAddress,node);_b.label=2;case 2:return _b.trys.push([2,4,,5]),[4,resolver.getAvatar()];case 3:return(avatar_1=_b.sent())?[2,avatar_1.url]:[3,5];case 4:error_11=_b.sent();if(error_11.code!==logger_1.Logger.errors.CALL_EXCEPTION)throw error_11;return[3,5];case 5:return _b.trys.push([5,8,,9]),_a=_parseString,[4,this.call({to:resolverAddress,data:"0x691f3431"+(0,hash_1.namehash)(node).substring(2)})];
case 6:return name_1=_a.apply(void 0,[_b.sent(),0]),[4,this.getResolver(name_1)];case 7:return resolver=_b.sent(),[3,9];case 8:error_12=_b.sent();if(error_12.code!==logger_1.Logger.errors.CALL_EXCEPTION)throw error_12;return[2,null];case 9:return[3,12];case 10:return[4,this.getResolver(nameOrAddress)];case 11:resolver=_b.sent();if(!resolver)return[2,null];_b.label=12;case 12:return[4,resolver.getAvatar()];case 13:return avatar=_b.sent(),null==avatar?[2,null]:[2,avatar.url]}})})};BaseProvider.prototype.perform=
function(method,params){return logger.throwError(method+" not implemented",logger_1.Logger.errors.NOT_IMPLEMENTED,{operation:method})};BaseProvider.prototype._startEvent=function(event){this.polling=0<this._events.filter(function(e){return e.pollable()}).length};BaseProvider.prototype._stopEvent=function(event){this.polling=0<this._events.filter(function(e){return e.pollable()}).length};BaseProvider.prototype._addEventListener=function(eventName,listener,once){eventName=new Event$jscomp$0(getEventTag(eventName),
listener,once);this._events.push(eventName);this._startEvent(eventName);return this};BaseProvider.prototype.on=function(eventName,listener){return this._addEventListener(eventName,listener,!1)};BaseProvider.prototype.once=function(eventName,listener){return this._addEventListener(eventName,listener,!0)};BaseProvider.prototype.emit=function(eventName){for(var _this=this,args=[],_i=1;_i<arguments.length;_i++)args[_i-1]=arguments[_i];var result=!1,stopped=[],eventTag=getEventTag(eventName);this._events=
this._events.filter(function(event){if(event.tag!==eventTag)return!0;setTimeout(function(){event.listener.apply(_this,args)},0);result=!0;return event.once?(stopped.push(event),!1):!0});stopped.forEach(function(event){_this._stopEvent(event)});return result};BaseProvider.prototype.listenerCount=function(eventName){if(!eventName)return this._events.length;var eventTag=getEventTag(eventName);return this._events.filter(function(event){return event.tag===eventTag}).length};BaseProvider.prototype.listeners=
function(eventName){if(null==eventName)return this._events.map(function(event){return event.listener});var eventTag=getEventTag(eventName);return this._events.filter(function(event){return event.tag===eventTag}).map(function(event){return event.listener})};BaseProvider.prototype.off=function(eventName,listener){var _this=this;if(null==listener)return this.removeAllListeners(eventName);var stopped=[],found=!1,eventTag=getEventTag(eventName);this._events=this._events.filter(function(event){if(event.tag!==
eventTag||event.listener!=listener||found)return!0;found=!0;stopped.push(event);return!1});stopped.forEach(function(event){_this._stopEvent(event)});return this};BaseProvider.prototype.removeAllListeners=function(eventName){var _this=this,stopped=[];if(null==eventName)stopped=this._events,this._events=[];else{var eventTag_1=getEventTag(eventName);this._events=this._events.filter(function(event){if(event.tag!==eventTag_1)return!0;stopped.push(event);return!1})}stopped.forEach(function(event){_this._stopEvent(event)});
return this};return BaseProvider}(abstract_provider_1.Provider);exports.BaseProvider=require}
//# sourceMappingURL=module$node_modules$$ethersproject$providers$lib$base_provider.js.map
