{
"version":3,
"file":"module$node_modules$viem$_cjs$clients$transports$fallback.js",
"lineCount":6,
"mappings":"AAAAA,cAAA,CAAA,yDAAA,CAA8E,QAAQ,CAACC,MAAD,CAAQC,OAAR,CAAgBC,MAAhB,CAAuBC,OAAvB,CAAgC,CAwEtHC,QAASA,eAAc,CAAC,CAAEC,KAAF,CAASC,QAAA,CAAW,GAApB,CAA0BC,YAA1B,CAAwCC,WAAA,CAAc,EAAtD,CAA0DC,OAAA,CAAU,GAApE,CAA0EC,UAA1E,CAAsFC,OAAA,CAAU,EAAhG,CAAD,CAAwG,CAC3H,MAAM,CAAE,UAAWC,eAAA,CAAkB,EAA/B,CAAoC,QAASC,aAAA,CAAgB,EAA7D,CAAA,CAAqEF,OAA3E,CACMG,QAAU,EADhB,CAEMC,gBAAkBA,KAAM,EAANA,EAAY,CAChC,IAAMC,gBAAS,MAAMC,OAAQC,CAAAA,GAAR,CAAYR,UAAWS,CAAAA,GAAX,CAAe,KAAOC,UAAP,EAAqB,CACjE,IAAMC,WAAaD,SAAA,CAAU,CAAEf,KAAF,CAASiB,WAAY,CAArB,CAAwBb,OAAxB,CAAV,CACbc,UAAAA,CAAQC,IAAKC,CAAAA,GAAL,EAEd,KAAIC,OACJ,IAAI,CACA,MAAML,UAAWM,CAAAA,OAAX,CAAmB,CAAEC,OAAQ,eAAV,CAAnB,CACN;AAAAF,OAAA,CAAU,CAFV,CAIJ,KAAM,CACFA,OAAA,CAAU,CADR,CAJN,OAOQ,CACJG,UAAA,CAAML,IAAKC,CAAAA,GAAL,EADF,CAIR,MAAO,CAAEK,QADOD,UACPC,CADaP,SACf,CAAWG,OAAX,CAhB0D,CAApC,CAAZ,CAkBrBZ,QAAQiB,CAAAA,IAAR,CAAaf,eAAb,CACIF,QAAQkB,CAAAA,MAAZ,CAAqBxB,WAArB,EACIM,OAAQmB,CAAAA,KAAR,EACJ,OAAMC,WAAaC,IAAKC,CAAAA,GAAL,CAAS,GAAGtB,OAAQK,CAAAA,GAAR,CAAaH,MAAD,EAAYmB,IAAKC,CAAAA,GAAL,CAAS,GAAGpB,MAAOG,CAAAA,GAAP,CAAW,CAAC,CAAEW,OAAF,CAAD,CAAA,EAAiBA,OAA5B,CAAZ,CAAxB,CAAZ,CACbO,gBAAAA,CAAS3B,UACVS,CAAAA,GADU,CACN,CAACmB,CAAD,CAAIC,CAAJ,CAAA,EAAU,CACTC,CAAAA,CAAY1B,OAAQK,CAAAA,GAAR,CAAaH,MAAD,EAAYA,MAAAc,CAAOS,CAAPT,CAAUA,CAAAA,OAAlC,CAGZW,EAAAA,CAAe,CAAfA,CAFcD,CAAUE,CAAAA,MAAV,CAAiB,CAACC,GAAD,CAAMb,OAAN,CAAA,EAAkBa,GAAlB,CAAwBb,OAAzC,CAAkD,CAAlD,CAEdW,CADFD,CAAUR,CAAAA,MACRS,CAAiCP,UACvC,KAAMU,UAAY9B,OAAQK,CAAAA,GAAR,CAAaH,MAAD,EAAYA,MAAAU,CAAOa,CAAPb,CAAUA,CAAAA,OAAlC,CACZmB,UAAAA,CAAiBD,SAAUF,CAAAA,MAAV,CAAiB,CAACC,GAAD;AAAMjB,OAAN,CAAA,EAAkBiB,GAAlB,CAAwBjB,OAAzC,CAAkD,CAAlD,CAAjBmB,CACFD,SAAUZ,CAAAA,MACd,OAAuB,EAAvB,GAAIa,SAAJ,CACW,CAAC,CAAD,CAAIN,CAAJ,CADX,CAEO,CACH1B,aADG,CACa4B,CADb,CAC4B7B,eAD5B,CAC8CiC,SAD9C,CAEHN,CAFG,CAVQ,CADJ,CAgBVO,CAAAA,IAhBU,CAgBL,CAACC,CAAD,CAAIC,CAAJ,CAAA,EAAUA,CAAA,CAAE,CAAF,CAAV,CAAiBD,CAAA,CAAE,CAAF,CAhBZ,CAiBfxC,aAAA,CAAa8B,eAAOlB,CAAAA,GAAP,CAAW,CAAC,CAAA,CAAGoB,CAAH,CAAD,CAAA,EAAW7B,UAAA,CAAW6B,CAAX,CAAtB,CAAb,CACA,OAAM,GAAIU,SAAUC,CAAAA,IAAd,EAAoB5C,QAApB,CACNS,gBAAA,EA1CgC,CA4CpCA,gBAAA,EA/C2H,CAtE/HoC,MAAOC,CAAAA,cAAP,CAAsBjD,OAAtB,CAA+B,YAA/B,CAA6C,CAAEkD,MAAO,CAAA,CAAT,CAA7C,CACAlD,QAAQC,CAAAA,cAAR,CAAyBD,OAAQmD,CAAAA,QAAjC,CAA4C,IAAK,EACjD,OAAMC,kBAAoBtD,OAAA,CAAQ,kDAAR,CAA1B,CACMgD,UAAYhD,OAAA,CAAQ,0CAAR,CADlB;AAEMuD,qBAAuBvD,OAAA,CAAQ,kEAAR,CAiE7BE,QAAQmD,CAAAA,QAAR,CAhEAA,QAAiB,CAACG,WAAD,CAAcC,MAAA,CAAS,EAAvB,CAA2B,CACxC,MAAM,CAAEC,GAAA,CAAM,UAAR,CAAoBC,IAAA,CAAO,UAA3B,CAAuCC,IAAA,CAAO,CAAA,CAA9C,CAAqDvC,UAArD,CAAiEwC,UAAjE,CAAA,CAAiFJ,MACvF,OAAO,CAAC,CAAErD,KAAF,CAAS0D,eAAA,CAAkB,GAA3B,CAAiCtD,OAAjC,CAAD,CAAA,EAAgD,CACnD,IAAIC,WAAa+C,WAAjB,CACIO,WAAa,EAAAA,EAAM,EACvB,OAAM5C,mBAAY,GAAIoC,oBAAqBS,CAAAA,eAAzB,EAA0C,CACxDN,GADwD,CAExDC,IAFwD,CAGlDjC,aAAO,CAAC,CAAEC,MAAF,CAAUsC,MAAV,CAAD,CAAqB,CAC9B,MAAMC,MAAQA,KAAM,CAAC5B,CAAA,CAAI,CAAL,CAAN4B,EAAiB,CAC3B,MAAM/C,UAAYV,UAAA,CAAW6B,CAAX,CAAA,CAAc,CAAElC,KAAF,CAASiB,WAAY,CAArB,CAAwBb,OAAxB,CAAd,CAClB;GAAI,CACA,MAAM2D,SAAW,MAAMhD,SAAUO,CAAAA,OAAV,CAAkB,CACrCC,MADqC,CAErCsC,MAFqC,CAAlB,CAIvBF,WAAA,CAAW,CACPpC,MADO,CAECsC,MAFD,CAGPE,QAHO,CAIPhD,SAJO,CAKPiD,OAAQ,SALD,CAAX,CAOA,OAAOD,SAZP,CAcJ,MAAOE,GAAP,CAAY,CACRN,UAAA,CAAW,CACPO,MAAOD,GADA,CAEP1C,MAFO,CAGCsC,MAHD,CAIP9C,SAJO,CAKPiD,OAAQ,OALD,CAAX,CAOA,IAAI,GAAId,iBAAkBiB,CAAAA,oBAAtB,EAA4CF,GAA5C,CAAJ,CACI,KAAMA,IAAN,CACJ,GAAI/B,CAAJ,GAAU7B,UAAWsB,CAAAA,MAArB,CAA8B,CAA9B,CACI,KAAMsC,IAAN,CACJ,MAAOH,MAAA,CAAM5B,CAAN,CAAU,CAAV,CAZC,CAhBe,CA+B/B,OAAO4B,MAAA,EAhCuB,CAHsB,CAqCxD7C,UArCwD,CAsCxDwC,UAtCwD,CAuCxDW,KAAM,UAvCkD,CAA1C,CAwCf,CACCT,WAAaU,EAADV,EAASA,UAATA,CAAsBU,EADnC,CAEChE,WAAYA,UAAWS,CAAAA,GAAX,CAAgBuD,EAAD,EAAQA,EAAA,CAAG,CAAErE,KAAF,CAASiB,WAAY,CAArB,CAAH,CAAvB,CAFb,CAxCe,CA4ClB,IAAIuC,IAAJ,CAAU,CACN,MAAMc;AAA+B,QAAhB,GAAA,MAAOd,KAAP,CAA2BA,IAA3B,CAAkC,EACvDzD,eAAA,CAAe,CACXC,KADW,CAEXC,SAAUqE,WAAYrE,CAAAA,QAAtBA,EAAkCyD,eAFvB,CAGXxD,aAAekD,WAADlD,EAAkBG,UAAlBH,CAA+BkD,WAHlC,CAIXjD,YAAamE,WAAYnE,CAAAA,WAJd,CAKXC,QAASkE,WAAYlE,CAAAA,OALV,CAMXC,UANW,CAOXC,QAASgE,WAAYhE,CAAAA,OAPV,CAAf,CAFM,CAYV,MAAOS,mBA3D4C,CAFf,CAkH5CjB,QAAQC,CAAAA,cAAR,CAAyBA,cAzH6F;",
"sources":["node_modules/viem/_cjs/clients/transports/fallback.js"],
"sourcesContent":["shadow$provide[\"module$node_modules$viem$_cjs$clients$transports$fallback\"] = function(global,require,module,exports) {\n\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.rankTransports = exports.fallback = void 0;\nconst buildRequest_js_1 = require(\"../../utils/buildRequest.js\");\nconst wait_js_1 = require(\"../../utils/wait.js\");\nconst createTransport_js_1 = require(\"./createTransport.js\");\nfunction fallback(transports_, config = {}) {\n    const { key = 'fallback', name = 'Fallback', rank = false, retryCount, retryDelay, } = config;\n    return ({ chain, pollingInterval = 4000, timeout }) => {\n        let transports = transports_;\n        let onResponse = () => { };\n        const transport = (0, createTransport_js_1.createTransport)({\n            key,\n            name,\n            async request({ method, params }) {\n                const fetch = async (i = 0) => {\n                    const transport = transports[i]({ chain, retryCount: 0, timeout });\n                    try {\n                        const response = await transport.request({\n                            method,\n                            params,\n                        });\n                        onResponse({\n                            method,\n                            params: params,\n                            response,\n                            transport,\n                            status: 'success',\n                        });\n                        return response;\n                    }\n                    catch (err) {\n                        onResponse({\n                            error: err,\n                            method,\n                            params: params,\n                            transport,\n                            status: 'error',\n                        });\n                        if ((0, buildRequest_js_1.isDeterministicError)(err))\n                            throw err;\n                        if (i === transports.length - 1)\n                            throw err;\n                        return fetch(i + 1);\n                    }\n                };\n                return fetch();\n            },\n            retryCount,\n            retryDelay,\n            type: 'fallback',\n        }, {\n            onResponse: (fn) => (onResponse = fn),\n            transports: transports.map((fn) => fn({ chain, retryCount: 0 })),\n        });\n        if (rank) {\n            const rankOptions = (typeof rank === 'object' ? rank : {});\n            rankTransports({\n                chain,\n                interval: rankOptions.interval ?? pollingInterval,\n                onTransports: (transports_) => (transports = transports_),\n                sampleCount: rankOptions.sampleCount,\n                timeout: rankOptions.timeout,\n                transports,\n                weights: rankOptions.weights,\n            });\n        }\n        return transport;\n    };\n}\nexports.fallback = fallback;\nfunction rankTransports({ chain, interval = 4000, onTransports, sampleCount = 10, timeout = 1000, transports, weights = {}, }) {\n    const { stability: stabilityWeight = 0.7, latency: latencyWeight = 0.3 } = weights;\n    const samples = [];\n    const rankTransports_ = async () => {\n        const sample = await Promise.all(transports.map(async (transport) => {\n            const transport_ = transport({ chain, retryCount: 0, timeout });\n            const start = Date.now();\n            let end;\n            let success;\n            try {\n                await transport_.request({ method: 'net_listening' });\n                success = 1;\n            }\n            catch {\n                success = 0;\n            }\n            finally {\n                end = Date.now();\n            }\n            const latency = end - start;\n            return { latency, success };\n        }));\n        samples.push(sample);\n        if (samples.length > sampleCount)\n            samples.shift();\n        const maxLatency = Math.max(...samples.map((sample) => Math.max(...sample.map(({ latency }) => latency))));\n        const scores = transports\n            .map((_, i) => {\n            const latencies = samples.map((sample) => sample[i].latency);\n            const meanLatency = latencies.reduce((acc, latency) => acc + latency, 0) /\n                latencies.length;\n            const latencyScore = 1 - meanLatency / maxLatency;\n            const successes = samples.map((sample) => sample[i].success);\n            const stabilityScore = successes.reduce((acc, success) => acc + success, 0) /\n                successes.length;\n            if (stabilityScore === 0)\n                return [0, i];\n            return [\n                latencyWeight * latencyScore + stabilityWeight * stabilityScore,\n                i,\n            ];\n        })\n            .sort((a, b) => b[0] - a[0]);\n        onTransports(scores.map(([, i]) => transports[i]));\n        await (0, wait_js_1.wait)(interval);\n        rankTransports_();\n    };\n    rankTransports_();\n}\nexports.rankTransports = rankTransports;\n//# sourceMappingURL=fallback.js.map\n};"],
"names":["shadow$provide","global","require","module","exports","rankTransports","chain","interval","onTransports","sampleCount","timeout","transports","weights","stabilityWeight","latencyWeight","samples","rankTransports_","sample","Promise","all","map","transport","transport_","retryCount","start","Date","now","success","request","method","end","latency","push","length","shift","maxLatency","Math","max","scores","_","i","latencies","latencyScore","reduce","acc","successes","stabilityScore","sort","a","b","wait_js_1","wait","Object","defineProperty","value","fallback","buildRequest_js_1","createTransport_js_1","transports_","config","key","name","rank","retryDelay","pollingInterval","onResponse","createTransport","params","fetch","response","status","err","error","isDeterministicError","type","fn","rankOptions"]
}
