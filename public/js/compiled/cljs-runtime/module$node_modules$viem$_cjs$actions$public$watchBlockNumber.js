shadow$provide.module$node_modules$viem$_cjs$actions$public$watchBlockNumber=function(global,require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0});exports.watchBlockNumber=void 0;const fromHex_js_1=require("module$node_modules$viem$_cjs$utils$encoding$fromHex"),observe_js_1=require("module$node_modules$viem$_cjs$utils$observe"),poll_js_1=require("module$node_modules$viem$_cjs$utils$poll"),stringify_js_1=require("module$node_modules$viem$_cjs$utils$stringify"),getBlockNumber_js_1=
require("module$node_modules$viem$_cjs$actions$public$getBlockNumber");exports.watchBlockNumber=function(client,{emitOnBegin=!1,emitMissed=!1,onBlockNumber,onError,poll:poll_,pollingInterval=client.pollingInterval}){let prevBlockNumber;const pollBlockNumber=()=>{const observerId=(0,stringify_js_1.stringify)(["watchBlockNumber",client.uid,emitOnBegin,emitMissed,pollingInterval]);return(0,observe_js_1.observe)(observerId,{onBlockNumber,onError},emit=>(0,poll_js_1.poll)(async()=>{try{const blockNumber=
await (0,getBlockNumber_js_1.getBlockNumber)(client,{cacheTime:0});if(prevBlockNumber){if(blockNumber===prevBlockNumber)return;if(1<blockNumber-prevBlockNumber&&emitMissed)for(let i=prevBlockNumber+1n;i<blockNumber;i++)emit.onBlockNumber(i,prevBlockNumber),prevBlockNumber=i}if(!prevBlockNumber||blockNumber>prevBlockNumber)emit.onBlockNumber(blockNumber,prevBlockNumber),prevBlockNumber=blockNumber}catch(err){emit.onError?.(err)}},{emitOnBegin,interval:pollingInterval}))},subscribeBlockNumber=()=>{let active=
!0,unsubscribe=()=>active=!1;(async()=>{try{const {unsubscribe:unsubscribe_}=await client.transport.subscribe({params:["newHeads"],onData(data){active&&(data=(0,fromHex_js_1.hexToBigInt)(data.result?.number),onBlockNumber(data,prevBlockNumber),prevBlockNumber=data)},onError(error){onError?.(error)}});unsubscribe=unsubscribe_;active||unsubscribe()}catch(err){onError?.(err)}})();return unsubscribe};return("undefined"!==typeof poll_?poll_:"webSocket"!==client.transport.type)?pollBlockNumber():subscribeBlockNumber()}}
//# sourceMappingURL=module$node_modules$viem$_cjs$actions$public$watchBlockNumber.js.map
