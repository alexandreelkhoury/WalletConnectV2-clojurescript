{
"version":3,
"file":"module$node_modules$viem$_cjs$actions$public$watchContractEvent.js",
"lineCount":8,
"mappings":"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",
"sources":["node_modules/viem/_cjs/actions/public/watchContractEvent.js"],
"sourcesContent":["shadow$provide[\"module$node_modules$viem$_cjs$actions$public$watchContractEvent\"] = function(global,require,module,exports) {\n\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.watchContractEvent = void 0;\nconst getAbiItem_js_1 = require(\"../../utils/abi/getAbiItem.js\");\nconst observe_js_1 = require(\"../../utils/observe.js\");\nconst poll_js_1 = require(\"../../utils/poll.js\");\nconst stringify_js_1 = require(\"../../utils/stringify.js\");\nconst abi_js_1 = require(\"../../errors/abi.js\");\nconst rpc_js_1 = require(\"../../errors/rpc.js\");\nconst decodeEventLog_js_1 = require(\"../../utils/abi/decodeEventLog.js\");\nconst encodeEventTopics_js_1 = require(\"../../utils/abi/encodeEventTopics.js\");\nconst log_js_1 = require(\"../../utils/formatters/log.js\");\nconst createContractEventFilter_js_1 = require(\"./createContractEventFilter.js\");\nconst getBlockNumber_js_1 = require(\"./getBlockNumber.js\");\nconst getFilterChanges_js_1 = require(\"./getFilterChanges.js\");\nconst getLogs_js_1 = require(\"./getLogs.js\");\nconst uninstallFilter_js_1 = require(\"./uninstallFilter.js\");\nfunction watchContractEvent(client, { abi, address, args, batch = true, eventName, onError, onLogs, poll: poll_, pollingInterval = client.pollingInterval, strict: strict_, }) {\n    const enablePolling = typeof poll_ !== 'undefined' ? poll_ : client.transport.type !== 'webSocket';\n    const pollContractEvent = () => {\n        const observerId = (0, stringify_js_1.stringify)([\n            'watchContractEvent',\n            address,\n            args,\n            batch,\n            client.uid,\n            eventName,\n            pollingInterval,\n        ]);\n        const strict = strict_ ?? false;\n        return (0, observe_js_1.observe)(observerId, { onLogs, onError }, (emit) => {\n            let previousBlockNumber;\n            let filter;\n            let initialized = false;\n            const unwatch = (0, poll_js_1.poll)(async () => {\n                if (!initialized) {\n                    try {\n                        filter = (await (0, createContractEventFilter_js_1.createContractEventFilter)(client, {\n                            abi,\n                            address,\n                            args,\n                            eventName,\n                            strict,\n                        }));\n                    }\n                    catch { }\n                    initialized = true;\n                    return;\n                }\n                try {\n                    let logs;\n                    if (filter) {\n                        logs = await (0, getFilterChanges_js_1.getFilterChanges)(client, { filter });\n                    }\n                    else {\n                        const blockNumber = await (0, getBlockNumber_js_1.getBlockNumber)(client);\n                        if (previousBlockNumber && previousBlockNumber !== blockNumber) {\n                            logs = await (0, getLogs_js_1.getLogs)(client, {\n                                address,\n                                args,\n                                fromBlock: previousBlockNumber + 1n,\n                                toBlock: blockNumber,\n                                event: (0, getAbiItem_js_1.getAbiItem)({\n                                    abi,\n                                    name: eventName,\n                                }),\n                            });\n                        }\n                        else {\n                            logs = [];\n                        }\n                        previousBlockNumber = blockNumber;\n                    }\n                    if (logs.length === 0)\n                        return;\n                    if (batch)\n                        emit.onLogs(logs);\n                    else\n                        logs.forEach((log) => emit.onLogs([log]));\n                }\n                catch (err) {\n                    if (filter && err instanceof rpc_js_1.InvalidInputRpcError)\n                        initialized = false;\n                    emit.onError?.(err);\n                }\n            }, {\n                emitOnBegin: true,\n                interval: pollingInterval,\n            });\n            return async () => {\n                if (filter)\n                    await (0, uninstallFilter_js_1.uninstallFilter)(client, { filter });\n                unwatch();\n            };\n        });\n    };\n    const subscribeContractEvent = () => {\n        let active = true;\n        let unsubscribe = () => (active = false);\n        (async () => {\n            try {\n                const topics = eventName\n                    ? (0, encodeEventTopics_js_1.encodeEventTopics)({\n                        abi: abi,\n                        eventName: eventName,\n                        args,\n                    })\n                    : [];\n                const { unsubscribe: unsubscribe_ } = await client.transport.subscribe({\n                    params: ['logs', { address, topics }],\n                    onData(data) {\n                        if (!active)\n                            return;\n                        const log = data.result;\n                        try {\n                            const { eventName, args } = (0, decodeEventLog_js_1.decodeEventLog)({\n                                abi: abi,\n                                data: log.data,\n                                topics: log.topics,\n                                strict: strict_,\n                            });\n                            const formatted = (0, log_js_1.formatLog)(log, {\n                                args,\n                                eventName: eventName,\n                            });\n                            onLogs([formatted]);\n                        }\n                        catch (err) {\n                            let eventName;\n                            let isUnnamed;\n                            if (err instanceof abi_js_1.DecodeLogDataMismatch ||\n                                err instanceof abi_js_1.DecodeLogTopicsMismatch) {\n                                if (strict_)\n                                    return;\n                                eventName = err.abiItem.name;\n                                isUnnamed = err.abiItem.inputs?.some((x) => !('name' in x && x.name));\n                            }\n                            const formatted = (0, log_js_1.formatLog)(log, {\n                                args: isUnnamed ? [] : {},\n                                eventName,\n                            });\n                            onLogs([formatted]);\n                        }\n                    },\n                    onError(error) {\n                        onError?.(error);\n                    },\n                });\n                unsubscribe = unsubscribe_;\n                if (!active)\n                    unsubscribe();\n            }\n            catch (err) {\n                onError?.(err);\n            }\n        })();\n        return unsubscribe;\n    };\n    return enablePolling ? pollContractEvent() : subscribeContractEvent();\n}\nexports.watchContractEvent = watchContractEvent;\n//# sourceMappingURL=watchContractEvent.js.map\n};"],
"names":["shadow$provide","global","require","module","exports","Object","defineProperty","value","watchContractEvent","getAbiItem_js_1","observe_js_1","poll_js_1","stringify_js_1","abi_js_1","rpc_js_1","decodeEventLog_js_1","encodeEventTopics_js_1","log_js_1","createContractEventFilter_js_1","getBlockNumber_js_1","getFilterChanges_js_1","getLogs_js_1","uninstallFilter_js_1","client","abi","address","args","batch","eventName","onError","onLogs","poll_","pollingInterval","strict_","pollContractEvent","observerId","stringify","uid","strict","observe","emit","previousBlockNumber","filter","initialized","unwatch","poll","logs","getFilterChanges","blockNumber","getBlockNumber","getLogs","fromBlock","toBlock","event","getAbiItem","name","length","forEach","log","err","InvalidInputRpcError","createContractEventFilter","emitOnBegin","interval","uninstallFilter","subscribeContractEvent","active","unsubscribe","topics","encodeEventTopics","unsubscribe_","transport","subscribe","params","onData","data","result","decodeEventLog","formatted","formatLog","isUnnamed","DecodeLogDataMismatch","DecodeLogTopicsMismatch","abiItem","inputs","some","x","error","enablePolling","type"]
}
